<app-header></app-header>
<div class="upgrade-container">
  
  <!-- Alertas personalizadas -->
  <div *ngIf="mostrarMensaje" class="alert alert-{{tipoMensaje}}">
    <span>{{mensaje}}</span>
    <button class="close-btn" (click)="cerrarAlerta()"></button>
  </div>

  <!-- Header -->
  <div class="header">
    <h1>Elige tu Plan</h1>
    <p>Selecciona el plan que mejor se adapte a tus necesidades</p>
  </div>

  <!-- Planes -->
  <div class="planes-container">
    <!-- Plan Free -->
    <div class="plan-card" [class.plan-actual]="usuario?.plan === 'FREE'">
      <div class="plan-badge" *ngIf="usuario?.plan === 'FREE'">Plan Actual</div>
      <div class="plan-header">
        <h2>Free</h2>
        <div class="plan-precio">
          <span class="precio-grande">$0</span>
          <span class="precio-periodo">/ siempre</span>
        </div>
      </div>
      
      <div class="plan-beneficios">
        <ul>
          <li><i class="bi bi-check-circle-fill text-success"></i> Crear Proyectos</li>
          <li><i class="bi bi-check-circle-fill text-success"></i> Panel de Favoritos</li>
          <li><i class="bi bi-check-circle-fill text-success"></i> Exportar</li>
          <li><i class="bi bi-check-circle-fill text-success"></i> Presentacion</li>
          <li><i class="bi bi-x-circle-fill text-danger"></i> Crear Plantillas</li>
          <li><i class="bi bi-x-circle-fill text-danger"></i> Ver mis Plantillas</li>
          <li><i class="bi bi-x-circle-fill text-danger"></i> publicar Plantillas</li>
        </ul>
      </div>
      
      <button class="btn btn-plan" [disabled]="usuario?.plan === 'FREE'">
        {{ usuario?.plan === 'FREE' ? 'Plan Actual' : 'Downgrade' }}
      </button>
    </div>

    <!-- Plan Mensual -->
    <div class="plan-card plan-destacado" [class.plan-actual]="usuario?.plan === 'PREMIUM' && !esAnual">
      <div class="plan-badge" *ngIf="usuario?.plan === 'PREMIUM' && !esAnual">Plan Actual</div>
      <div class="plan-etiqueta">Popular</div>
      <div class="plan-header">
        <h2>Premium</h2>
        <div class="plan-precio">
          <span class="precio-grande">$9.99</span>
          <span class="precio-periodo">/ mes</span>
        </div>
      </div>
      
      <div class="plan-beneficios">
        <ul>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Proyectos ilimitados</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Panel de Favoritos</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Exportar</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Presentacion</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Crear Plantillas</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Ver mis Plantillas</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  publicar Plantillas</li>
        </ul>
      </div>
      
      <button class="btn btn-plan btn-primary" 
              (click)="seleccionarPlan('mensual')"
              [disabled]="usuario?.plan === 'PREMIUM' && !esAnual">
        {{ usuario?.plan === 'PREMIUM' && !esAnual ? 'Plan Actual' : 'Suscribirse' }}
      </button>
    </div>

    <!-- Plan Anual -->
    <div class="plan-card" [class.plan-actual]="usuario?.plan === 'PREMIUM' && esAnual">
      <div class="plan-badge" *ngIf="usuario?.plan === 'PREMIUM' && esAnual">Plan Actual</div>
      <div class="plan-ahorro">Ahorra 20%</div>
      <div class="plan-header">
        <h2>Premium Anual</h2>
        <div class="plan-precio">
          <span class="precio-grande">$99.99</span>
          <span class="precio-periodo">/ a帽o</span>
        </div>
        <div class="precio-equivalente">$8.33 / mes</div>
      </div>
      
      <div class="plan-beneficios">
        <ul>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Proyectos ilimitados</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Exportar</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Presentacion</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Crear Plantillas</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  Ver mis Plantillas</li>
          <li><i class="bi bi-check-circle-fill text-success"></i>  publicar Plantillas</li>
          <li><i class="bi bi-star-fill text-warning"></i> 2 meses gratis</li>
        </ul>
      </div>
      
      <button class="btn btn-plan btn-primary" 
              (click)="seleccionarPlan('anual')"
              [disabled]="usuario?.plan === 'PREMIUM' && esAnual">
        {{ usuario?.plan === 'PREMIUM' && esAnual ? 'Plan Actual' : 'Suscribirse' }}
      </button>
    </div>
  </div>

  <!-- Modal de Pago -->
  <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
    <div class="modal-contenido" (click)="$event.stopPropagation()">
      <button class="modal-cerrar" (click)="cerrarModal()"></button>
      
      <div class="modal-header">
        <h2>Informaci贸n de Pago</h2>
        <p>Completa los datos para confirmar tu suscripci贸n</p>
      </div>

      <!-- Resumen del plan seleccionado -->
      <div class="resumen-pago">
        <h3>Resumen de tu compra</h3>
        <div class="resumen-item">
          <span>Plan seleccionado:</span>
          <strong>{{ planSeleccionado === 'mensual' ? 'Premium Mensual' : 'Premium Anual' }}</strong>
        </div>
        <div class="resumen-item">
          <span>Total a pagar:</span>
          <strong class="precio-total">{{ planSeleccionado === 'mensual' ? '$9.99' : '$99.99' }}</strong>
        </div>
        <div class="resumen-nota">
          {{ planSeleccionado === 'mensual' ? 'Renovaci贸n autom谩tica cada mes' : 'Renovaci贸n autom谩tica cada a帽o' }}
        </div>
      </div>

      <!-- Formulario de pago -->
      <form class="formulario-pago">
        <div class="form-group">
          <label>N煤mero de Tarjeta</label>
          <input type="text" 
                 [(ngModel)]="datosPago.numeroTarjeta" 
                 name="numeroTarjeta"
                 (input)="formatearNumeroTarjeta($event)"
                 placeholder="1234 5678 9012 3456"
                 maxlength="19"
                 required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Fecha Expiraci贸n</label>
            <input type="text" 
                   [(ngModel)]="datosPago.fechaExpiracion" 
                   name="fechaExpiracion"
                   (input)="formatearFechaExpiracion($event)"
                   placeholder="MM/YY"
                   maxlength="5"
                   required>
          </div>

          <div class="form-group">
            <label>CVV</label>
            <input type="password" 
                   [(ngModel)]="datosPago.cvv" 
                   name="cvv"
                   maxlength="3"
                   placeholder="123"
                   required>
          </div>
        </div>

        <div class="form-group">
          <label>Nombre del Titular</label>
          <input type="text" 
                 [(ngModel)]="datosPago.nombreTitular" 
                 name="nombreTitular"
                 placeholder="Nombre completo"
                 required>
        </div>

        <div class="form-group">
          <label>Email para facturaci贸n</label>
          <input type="email" 
                 [(ngModel)]="datosPago.email" 
                 name="email"
                 [value]="usuario?.email"
                 placeholder="correo@ejemplo.com"
                 required>
        </div>

        <div class="seguridad">
          <span> Tu informaci贸n est谩 protegida con encriptaci贸n SSL</span>
        </div>
      </form>

      <!-- Botones del modal -->
      <div class="modal-acciones">
        <button class="btn btn-secondary" (click)="cerrarModal()">
          Cancelar
        </button>
        <button class="btn btn-primary" 
                (click)="procesarPago()"
                [disabled]="cargando">
          <span *ngIf="!cargando">Confirmar Pago</span>
          <span *ngIf="cargando" class="loading">
            <div class="spinner"></div>
            Procesando...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmaci贸n -->
  <div class="modal-overlay" *ngIf="pagoExitoso" (click)="cerrarModalExito()">
    <div class="modal-contenido modal-exito" (click)="$event.stopPropagation()">
      <div class="icono-exito"></div>
      <h2>隆Suscripci贸n Exitosa!</h2>
      <p>Ahora eres un usuario Premium</p>
      
      <div class="resumen-exito">
        <p><strong>Plan:</strong> {{ planSeleccionado === 'mensual' ? 'Premium Mensual' : 'Premium Anual' }}</p>
        <p><strong>Pago:</strong> {{ planSeleccionado === 'mensual' ? '$9.99 / mes' : '$99.99 / a帽o' }}</p>
        <p><strong>Pr贸xima facturaci贸n:</strong> {{ today | date:'longDate' }}</p>
      </div>

      <button class="btn btn-primary" (click)="cerrarModalExito()">
        Continuar
      </button>
    </div>
  </div>
</div>